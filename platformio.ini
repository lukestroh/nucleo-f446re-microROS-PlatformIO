; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html



; POSSIBLY USEFUL
; https://community.platformio.org/t/using-stm32cubemx-and-platformio/2611/30

[env]

[env:nucleo_f446re]
; src_dir = /home/luke/dev/PlatformIO/nucleo-f446re-microROS-PlatformIO/
platform = ststm32
; platform_packages = 
;     toolchain-gccarmnoneeabi@1.70201.0
board = nucleo_f446re
; select linker file generated by CubeMX
board_build.ldscript = STM32F446RETx_FLASH.ld
; make build system use our HAL config file
; board_build.stm32cube.custom_config_header = yes
framework = stm32cube
; lib_deps = FreeRTOS
build_flags =
    -mcpu=cortex-m4
    -mthumb
    -mfpu=fpv4-sp-d16
    -mfloat-abi=hard
    -DUSE_HAL_DRIVER
    -DSTM32F446xx
    ; -Mprint_cflags


    ; -mcpu=cortex-m4 -mthumb -mfpu=fpv4-sp-d16 -mfloat-abi=hard -DUSE_HAL_DRIVER -DSTM32F446xx -Iinclude -I~/.platformio/packages/framework-stm32cubef4/Drivers/STM32F4xx_HAL_Driver/Inc -I~/.platformio/packages/framework-stm32cubef4/Drivers/STM32F4xx_HAL_Driver/Inc/Legacy -I~/.platformio/packages/framework-stm32cubef4/Drivers/CMSIS/Device/ST/STM32F4xx/Include -I~/.platformio/packages/framework-stm32cubef4/Drivers/CMSIS/Include -IMiddlewares/Third_Party/FreeRTOS/Source/include -IMiddlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS_V2 -IMiddlewares/Third_Party/FreeRTOS/Source/portable/GCC/ARM_CM4F -Imicro_ros_stm32cubemx_utils/microros_static_library/libmicroros/microros_include -Og -Wall -fdata-sections -ffunction-sections -g -gdwarf-2 -MMD -MP -MFprint_cflags

    ; -print-multi-lib
    
    ; -fno-builtin
    # Includes
    -I"Middlewares/Third_Party/FreeRTOS/Source/include"
    -I"Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS_V2"
    -I"Middlewares/Third_Party/FreeRTOS/Source/portable/GCC/ARM_CM4F"
    -I"micro_ros_stm32cubemx_utils/microros_static_library/libmicroros/microros_include"
    -I"micro_ros_stm32cubemx_utils/extra_sources"
    -I"micro_ros_stm32cubemx_utils/extra_sources/microros_transports"
    # Libraries
    -L"micro_ros_stm32cubemx_utils/microros_static_library/libmicroros"
    -l"microros"

build_src_filter = 
    +<*.c>
    +<../Middlewares/Third_Party/FreeRTOS/Source/*.c>
    +<../Middlewares/Third_Party/FreeRTOS/Source/CMSIS_RTOS_V2/*.c>
    +<../Middlewares/Third_Party/FreeRTOS/Source/portable/*.c>
    +<../Middlewares/Third_Party/FreeRTOS/Source/portable/GCC/ARM_CM4F/*.c>
    +<../Middlewares/Third_Party/FreeRTOS/Source/portable/MemMang/heap_4.c>
    +<../micro_ros_stm32cubemx_utils/extra_sources/*.c>
    +<../micro_ros_stm32cubemx_utils/extra_sources/microros_transports/dma_transport.c> # change here for UDP transport

lib_archive = no
